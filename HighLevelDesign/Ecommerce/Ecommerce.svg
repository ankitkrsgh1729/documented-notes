<svg viewBox="0 0 1600 1200" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect width="1600" height="1200" fill="#f8f9fa"/>
  
  <!-- Title -->
  <text x="800" y="30" text-anchor="middle" font-size="24" font-weight="bold" fill="#2c3e50">
    E-commerce Platform - Corrected HLD Architecture
  </text>
  
  <!-- ===== CLIENT LAYER ===== -->
  <g id="client-layer">
    <!-- Users -->
    <circle cx="100" cy="80" r="25" fill="#3498db"/>
    <text x="100" y="85" text-anchor="middle" font-size="12" fill="white" font-weight="bold">üë§</text>
    <text x="100" y="110" text-anchor="middle" font-size="10" fill="#2c3e50">Web Users</text>
    
    <circle cx="200" cy="80" r="25" fill="#3498db"/>
    <text x="200" y="85" text-anchor="middle" font-size="12" fill="white" font-weight="bold">üì±</text>
    <text x="200" y="110" text-anchor="middle" font-size="10" fill="#2c3e50">Mobile Users</text>
    
    <circle cx="300" cy="80" r="25" fill="#3498db"/>
    <text x="300" y="85" text-anchor="middle" font-size="12" fill="white" font-weight="bold">üè¢</text>
    <text x="300" y="110" text-anchor="middle" font-size="10" fill="#2c3e50">Admin Panel</text>
  </g>
  
  <!-- ===== DNS LAYER ===== -->
  <rect x="50" y="130" width="200" height="40" rx="8" fill="#f39c12" stroke="#e67e22" stroke-width="2"/>
  <text x="150" y="155" text-anchor="middle" font-size="14" fill="white" font-weight="bold">DNS (Route 53)</text>
  <rect x="90" y="165" width="120" height="18" rx="3" fill="white" opacity="0.9" stroke="#e67e22"/>
  <text x="150" y="177" text-anchor="middle" font-size="12" fill="#e67e22" font-weight="bold">Geographic Routing</text>
  
  <!-- ===== CDN LAYER ===== -->
  <rect x="300" y="130" width="300" height="40" rx="8" fill="#e74c3c" opacity="0.9" stroke="#c0392b" stroke-width="2"/>
  <text x="450" y="155" text-anchor="middle" font-size="14" fill="white" font-weight="bold">CDN (CloudFront)</text>
  <rect x="390" y="165" width="120" height="18" rx="3" fill="white" opacity="0.9" stroke="#c0392b"/>
  <text x="450" y="177" text-anchor="middle" font-size="12" fill="#c0392b" font-weight="bold">Static Assets Only</text>
  
  <!-- ===== LOAD BALANCER LAYER ===== -->
  <rect x="200" y="200" width="400" height="50" rx="8" fill="#27ae60" stroke="#2ecc71" stroke-width="2"/>
  <text x="400" y="220" text-anchor="middle" font-size="14" fill="white" font-weight="bold">Regional Application Load Balancer</text>
  <text x="400" y="235" text-anchor="middle" font-size="12" fill="white">Multi-AZ ‚Ä¢ Health Checks ‚Ä¢ SSL Termination</text>
  <rect x="290" y="245" width="220" height="18" rx="3" fill="white" opacity="0.9" stroke="#2ecc71"/>
  <text x="400" y="257" text-anchor="middle" font-size="12" fill="#2c3e50" font-weight="bold">us-east-1, eu-west-1, ap-southeast-1</text>
  
  <!-- ===== API GATEWAY LAYER ===== -->
  <rect x="250" y="290" width="300" height="60" rx="8" fill="#2980b9" stroke="#3498db" stroke-width="2"/>
  <text x="400" y="315" text-anchor="middle" font-size="16" fill="white" font-weight="bold">API Gateway</text>
  <text x="400" y="330" text-anchor="middle" font-size="12" fill="white">JWT Validation ‚Ä¢ Rate Limit ‚Ä¢ Circuit Breaker</text>
  <text x="400" y="345" text-anchor="middle" font-size="11" fill="white">Request/Response Transform ‚Ä¢ Routing</text>
  
  <!-- ===== MICROSERVICES LAYER ===== -->
  <g id="microservices-layer">
    <!-- User Service -->
    <rect x="50" y="400" width="120" height="60" rx="5" fill="#9b59b6" stroke="#8e44ad" stroke-width="2"/>
    <text x="110" y="425" text-anchor="middle" font-size="12" fill="white" font-weight="bold">User Service</text>
    <text x="110" y="440" text-anchor="middle" font-size="10" fill="white">Auth ‚Ä¢ Profile ‚Ä¢ RBAC</text>
    <text x="110" y="475" text-anchor="middle" font-size="9" fill="#8e44ad" font-weight="bold">Auto-scale: 2-10 instances</text>
    
    <!-- Catalog Service -->
    <rect x="200" y="400" width="120" height="60" rx="5" fill="#e67e22" stroke="#d35400" stroke-width="2"/>
    <text x="260" y="425" text-anchor="middle" font-size="12" fill="white" font-weight="bold">Catalog Service</text>
    <text x="260" y="440" text-anchor="middle" font-size="10" fill="white">Search ‚Ä¢ Products</text>
    <text x="260" y="475" text-anchor="middle" font-size="9" fill="#d35400" font-weight="bold">Auto-scale: 3-15 instances</text>
    
    <!-- Order Service -->
    <rect x="350" y="400" width="120" height="60" rx="5" fill="#c0392b" stroke="#a93226" stroke-width="2"/>
    <text x="410" y="425" text-anchor="middle" font-size="12" fill="white" font-weight="bold">Order Service</text>
    <text x="410" y="440" text-anchor="middle" font-size="10" fill="white">Cart ‚Ä¢ Orders ‚Ä¢ State Machine</text>
    <text x="410" y="475" text-anchor="middle" font-size="9" fill="#a93226" font-weight="bold">Auto-scale: 2-8 instances</text>
    
    <!-- Payment Service -->
    <rect x="500" y="400" width="120" height="60" rx="5" fill="#8e44ad" stroke="#7d3c98" stroke-width="2"/>
    <text x="560" y="425" text-anchor="middle" font-size="12" fill="white" font-weight="bold">Payment Service</text>
    <text x="560" y="440" text-anchor="middle" font-size="10" fill="white">PCI Compliant</text>
    <text x="560" y="475" text-anchor="middle" font-size="9" fill="#7d3c98" font-weight="bold">Auto-scale: 2-6 instances</text>
    
    <!-- Notification Service -->
    <rect x="650" y="400" width="120" height="60" rx="5" fill="#7f8c8d" stroke="#6c7b7d" stroke-width="2"/>
    <text x="710" y="425" text-anchor="middle" font-size="12" fill="white" font-weight="bold">Notification Service</text>
    <text x="710" y="440" text-anchor="middle" font-size="10" fill="white">Email ‚Ä¢ SMS ‚Ä¢ Push</text>
    <text x="710" y="475" text-anchor="middle" font-size="9" fill="#6c7b7d" font-weight="bold">Auto-scale: 2-5 instances</text>
  </g>
  
  <!-- ===== CACHING LAYER ===== -->
  <rect x="200" y="520" width="400" height="50" rx="8" fill="#e74c3c" stroke="#c0392b" stroke-width="2"/>
  <text x="400" y="540" text-anchor="middle" font-size="14" fill="white" font-weight="bold">Redis Cluster (3M + 3R)</text>
  <text x="400" y="555" text-anchor="middle" font-size="12" fill="yellow" font-weight="bold">‚ö†Ô∏è 33% data loss if master+replica pair fails</text>
  <rect x="290" y="565" width="220" height="20" rx="3" fill="white" opacity="0.9" stroke="#c0392b"/>
  <text x="400" y="578" text-anchor="middle" font-size="12" fill="#c0392b" font-weight="bold">Session ‚Ä¢ Products ‚Ä¢ Search ‚Ä¢ Cart</text>
  
  <!-- ===== MESSAGE QUEUE LAYER ===== -->
  <rect x="150" y="600" width="500" height="50" rx="8" fill="#f39c12" stroke="#e67e22" stroke-width="2"/>
  <text x="400" y="620" text-anchor="middle" font-size="14" fill="white" font-weight="bold">Apache Kafka Cluster</text>
  <text x="400" y="635" text-anchor="middle" font-size="11" fill="white">Event Streaming ‚Ä¢ Order Events ‚Ä¢ Payment Events ‚Ä¢ Notifications</text>
  
  <!-- ===== DATABASE LAYER - SEPARATED PER SERVICE ===== -->
  <g id="database-layer">
    <!-- User Service Database -->
    <rect x="30" y="700" width="120" height="70" rx="5" fill="#336791" stroke="#2c5282" stroke-width="2"/>
    <text x="90" y="720" text-anchor="middle" font-size="12" fill="white" font-weight="bold">User PostgreSQL</text>
    <text x="90" y="735" text-anchor="middle" font-size="10" fill="white">Primary + Replicas</text>
    <text x="90" y="750" text-anchor="middle" font-size="10" fill="white">Users ‚Ä¢ Auth</text>
    <text x="90" y="765" text-anchor="middle" font-size="10" fill="white">Multi-AZ</text>
    
    <!-- Catalog Service Database -->
    <rect x="180" y="700" width="120" height="70" rx="5" fill="#005571" stroke="#003d4f" stroke-width="2"/>
    <text x="240" y="720" text-anchor="middle" font-size="12" fill="white" font-weight="bold">Elasticsearch</text>
    <text x="240" y="735" text-anchor="middle" font-size="10" fill="white">3-node cluster</text>
    <text x="240" y="750" text-anchor="middle" font-size="10" fill="white">Product Catalog</text>
    <text x="240" y="765" text-anchor="middle" font-size="10" fill="white">Search Index</text>
    
    <!-- Order Service Database -->
    <rect x="330" y="700" width="120" height="70" rx="5" fill="#336791" stroke="#2c5282" stroke-width="2"/>
    <text x="390" y="720" text-anchor="middle" font-size="12" fill="white" font-weight="bold">Order PostgreSQL</text>
    <text x="390" y="735" text-anchor="middle" font-size="10" fill="white">Primary + Replicas</text>
    <text x="390" y="750" text-anchor="middle" font-size="10" fill="white">Orders ‚Ä¢ Cart</text>
    <text x="390" y="765" text-anchor="middle" font-size="10" fill="white">ACID Required</text>
    
    <!-- Payment Service Database -->
    <rect x="480" y="700" width="120" height="70" rx="5" fill="#336791" stroke="#2c5282" stroke-width="2"/>
    <text x="540" y="720" text-anchor="middle" font-size="12" fill="white" font-weight="bold">Payment PostgreSQL</text>
    <text x="540" y="735" text-anchor="middle" font-size="10" fill="white">Primary + Replicas</text>
    <text x="540" y="750" text-anchor="middle" font-size="10" fill="white">Payments ‚Ä¢ Audit</text>
    <text x="540" y="765" text-anchor="middle" font-size="10" fill="white">PCI Compliant</text>
    
    <!-- Notification Service Database -->
    <rect x="630" y="700" width="120" height="70" rx="5" fill="#4DB33D" stroke="#3d8b2a" stroke-width="2"/>
    <text x="690" y="720" text-anchor="middle" font-size="12" fill="white" font-weight="bold">MongoDB</text>
    <text x="690" y="735" text-anchor="middle" font-size="10" fill="white">Sharded Cluster</text>
    <text x="690" y="750" text-anchor="middle" font-size="10" fill="white">User Preferences</text>
    <text x="690" y="765" text-anchor="middle" font-size="10" fill="white">Flexible Schema</text>
  </g>
  
  <!-- ===== EXTERNAL SERVICES ===== -->
  <g id="external-services">
    <!-- Payment Gateways -->
    <rect x="850" y="400" width="120" height="60" rx="5" fill="#34495e" stroke="#2c3e50" stroke-width="2"/>
    <text x="910" y="425" text-anchor="middle" font-size="12" fill="white" font-weight="bold">Payment Gateways</text>
    <text x="910" y="440" text-anchor="middle" font-size="10" fill="white">Stripe ‚Ä¢ PayPal</text>
    <text x="910" y="455" text-anchor="middle" font-size="10" fill="white">External APIs</text>
    
    <!-- Communication APIs -->
    <rect x="850" y="520" width="120" height="60" rx="5" fill="#34495e" stroke="#2c3e50" stroke-width="2"/>
    <text x="910" y="545" text-anchor="middle" font-size="12" fill="white" font-weight="bold">Communication APIs</text>
    <text x="910" y="560" text-anchor="middle" font-size="10" fill="white">SendGrid ‚Ä¢ Twilio</text>
    <text x="910" y="575" text-anchor="middle" font-size="10" fill="white">AWS SES ‚Ä¢ SNS</text>
  </g>
  
  <!-- ===== REQUEST FLOW ARROWS ===== -->
  <g id="request-flow" stroke="#e74c3c" stroke-width="2" fill="#e74c3c">
    <!-- Users to DNS -->
    <line x1="150" y1="105" x2="150" y2="130" marker-end="url(#arrowhead-red)"/>
    <line x1="200" y1="105" x2="200" y2="130" marker-end="url(#arrowhead-red)"/>
    
    <!-- Static Assets: DNS to CDN -->
    <line x1="250" y1="150" x2="300" y2="150" marker-end="url(#arrowhead-red)"/>
    <rect x="260" y="120" width="70" height="18" rx="3" fill="white" opacity="0.9" stroke="#e74c3c"/>
    <text x="295" y="132" text-anchor="middle" font-size="12" fill="#e74c3c" font-weight="bold">Static Assets</text>
    
    <!-- Dynamic APIs: DNS to Load Balancer -->
    <line x1="200" y1="170" x2="300" y2="200" marker-end="url(#arrowhead-red)"/>
    <rect x="210" y="172" width="75" height="18" rx="3" fill="white" opacity="0.9" stroke="#e74c3c"/>
    <text x="248" y="184" text-anchor="middle" font-size="12" fill="#e74c3c" font-weight="bold">Dynamic APIs</text>
    
    <!-- CDN to Load Balancer (cache miss) -->
    <line x1="450" y1="170" x2="450" y2="200" marker-end="url(#arrowhead-red)"/>
    <rect x="410" y="172" width="60" height="18" rx="3" fill="white" opacity="0.9" stroke="#e74c3c"/>
    <text x="440" y="184" text-anchor="middle" font-size="12" fill="#e74c3c" font-weight="bold">Cache Miss</text>
    
    <!-- Load Balancer to API Gateway -->
    <line x1="400" y1="250" x2="400" y2="290" marker-end="url(#arrowhead-red)"/>
    
    <!-- API Gateway to Services -->
    <line x1="350" y1="350" x2="110" y2="400" marker-end="url(#arrowhead-red)"/>
    <line x1="380" y1="350" x2="260" y2="400" marker-end="url(#arrowhead-red)"/>
    <line x1="400" y1="350" x2="410" y2="400" marker-end="url(#arrowhead-red)"/>
    <line x1="420" y1="350" x2="560" y2="400" marker-end="url(#arrowhead-red)"/>
    
    <!-- Order Service to Payment Service (SYNC CALL) -->
    <line x1="470" y1="430" x2="500" y2="430" marker-end="url(#arrowhead-red)" stroke="#ff6b6b" stroke-width="3"/>
    <rect x="465" y="400" width="45" height="20" rx="3" fill="white" opacity="0.9" stroke="#ff6b6b" stroke-width="2"/>
    <text x="487" y="413" text-anchor="middle" font-size="14" fill="#ff6b6b" font-weight="bold">SYNC</text>
    
    <!-- Services to Cache -->
    <line x1="260" y1="460" x2="320" y2="520" marker-end="url(#arrowhead-red)"/>
    <line x1="410" y1="460" x2="450" y2="520" marker-end="url(#arrowhead-red)"/>
    
    <!-- Services to Their Respective Databases -->
    <line x1="110" y1="460" x2="90" y2="700" marker-end="url(#arrowhead-red)"/>
    <line x1="260" y1="460" x2="240" y2="700" marker-end="url(#arrowhead-red)"/>
    <line x1="410" y1="460" x2="390" y2="700" marker-end="url(#arrowhead-red)"/>
    <line x1="560" y1="460" x2="540" y2="700" marker-end="url(#arrowhead-red)"/>
    <line x1="710" y1="460" x2="690" y2="700" marker-end="url(#arrowhead-red)"/>
    
    <!-- External API calls -->
    <line x1="620" y1="430" x2="850" y2="430" marker-end="url(#arrowhead-purple)" stroke="#8e44ad"/>
    <line x1="770" y1="460" x2="850" y2="550" marker-end="url(#arrowhead-purple)" stroke="#8e44ad"/>
  </g>
  
  <!-- ===== EVENT FLOW (Async) ===== -->
  <g id="event-flow" stroke="#f39c12" stroke-width="2" fill="#f39c12" stroke-dasharray="5,5">
    <!-- Order Service to Kafka -->
    <line x1="410" y1="460" x2="380" y2="600" marker-end="url(#arrowhead-orange)"/>
    <rect x="350" y="510" width="80" height="20" rx="3" fill="white" opacity="0.9" stroke="#f39c12"/>
    <text x="390" y="523" text-anchor="middle" font-size="12" fill="#f39c12" font-weight="bold">OrderCreated</text>
    
    <!-- Payment Service to Kafka -->
    <line x1="560" y1="460" x2="450" y2="600" marker-end="url(#arrowhead-orange)"/>
    <rect x="460" y="510" width="100" height="20" rx="3" fill="white" opacity="0.9" stroke="#f39c12"/>
    <text x="510" y="523" text-anchor="middle" font-size="12" fill="#f39c12" font-weight="bold">PaymentProcessed</text>
    
    <!-- Kafka to Notification Service -->
    <line x1="500" y1="600" x2="710" y2="460" marker-end="url(#arrowhead-orange)"/>
    <rect x="560" y="515" width="130" height="20" rx="3" fill="white" opacity="0.9" stroke="#f39c12"/>
    <text x="625" y="528" text-anchor="middle" font-size="12" fill="#f39c12" font-weight="bold">Events‚ÜíNotifications</text>
  </g>
  
  <!-- ===== PERFORMANCE METRICS ===== -->
  <rect x="50" y="820" width="700" height="100" rx="8" fill="#2ecc71" stroke="#27ae60" stroke-width="2"/>
  <text x="400" y="845" text-anchor="middle" font-size="16" fill="white" font-weight="bold">Corrected Architecture Highlights</text>
  <text x="400" y="865" text-anchor="middle" font-size="12" fill="white">‚úÖ Separate DB per service ‚Ä¢ ‚úÖ Order‚ÜíPayment sync call ‚Ä¢ ‚úÖ Geographic DNS routing</text>
  <text x="400" y="880" text-anchor="middle" font-size="12" fill="white">‚úÖ CDN for static only ‚Ä¢ ‚úÖ Redis data loss awareness ‚Ä¢ ‚úÖ External API separation</text>
  <text x="400" y="895" text-anchor="middle" font-size="12" fill="white">P95: &lt;300ms ‚Ä¢ Throughput: 1000+ RPS ‚Ä¢ Uptime: 99.9% ‚Ä¢ Scale: 20M DAU</text>
  <text x="400" y="910" text-anchor="middle" font-size="12" fill="white">MongoDB: Flexible user preferences ‚Ä¢ PostgreSQL: ACID compliance ‚Ä¢ Event-driven notifications</text>
  
  <!-- ===== DATA FLOW LEGEND ===== -->
  <rect x="800" y="820" width="350" height="120" rx="8" fill="#34495e" stroke="#2c3e50" stroke-width="2"/>
  <text x="975" y="845" text-anchor="middle" font-size="14" fill="white" font-weight="bold">Data Flow Legend</text>
  
  <line x1="820" y1="860" x2="860" y2="860" stroke="#e74c3c" stroke-width="2" marker-end="url(#arrowhead-red)"/>
  <text x="870" y="865" font-size="11" fill="white">Request Flow (User ‚Üí Services ‚Üí DB)</text>
  
  <line x1="820" y1="880" x2="860" y2="880" stroke="#ff6b6b" stroke-width="3" marker-end="url(#arrowhead-red)"/>
  <text x="870" y="885" font-size="11" fill="white">Synchronous Service Calls</text>
  
  <line x1="820" y1="900" x2="860" y2="900" stroke="#f39c12" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead-orange)"/>
  <text x="870" y="905" font-size="11" fill="white">Async Events via Kafka</text>
  
  <line x1="820" y1="920" x2="860" y2="920" stroke="#8e44ad" stroke-width="2" marker-end="url(#arrowhead-purple)"/>
  <text x="870" y="925" font-size="11" fill="white">External API Calls</text>
  
  <!-- ===== EXAMPLE FLOW ===== -->
  <rect x="1200" y="150" width="350" height="250" rx="8" fill="#ecf0f1" stroke="#bdc3c7" stroke-width="2"/>
  <text x="1375" y="175" text-anchor="middle" font-size="14" fill="#2c3e50" font-weight="bold">Example: Order Placement Flow</text>
  <text x="1220" y="200" font-size="11" fill="#2c3e50">1. User places order ‚Üí DNS routes to nearest region</text>
  <text x="1220" y="215" font-size="11" fill="#2c3e50">2. Regional LB ‚Üí API Gateway (JWT validation)</text>
  <text x="1220" y="230" font-size="11" fill="#2c3e50">3. Order Service creates order ‚Üí Order PostgreSQL</text>
  <text x="1220" y="245" font-size="11" fill="#2c3e50">4. Order Service ‚Üí Payment Service (SYNC call)</text>
  <text x="1220" y="260" font-size="11" fill="#2c3e50">5. Payment Service ‚Üí Stripe/PayPal API</text>
  <text x="1220" y="275" font-size="11" fill="#2c3e50">6. Payment Service ‚Üí Payment PostgreSQL</text>
  <text x="1220" y="290" font-size="11" fill="#2c3e50">7. Payment Service ‚Üí Kafka (PaymentProcessed)</text>
  <text x="1220" y="305" font-size="11" fill="#2c3e50">8. Notification Service consumes ‚Üí SendGrid</text>
  <text x="1220" y="320" font-size="11" fill="#2c3e50">9. Response flows back to user</text>
  <text x="1220" y="340" font-size="11" fill="#27ae60">üìä Order response: ~200ms (sync)</text>
  <text x="1220" y="355" font-size="11" fill="#f39c12">üìä Email delivery: ~2-5s (async)</text>
  <text x="1220" y="375" font-size="11" fill="#e74c3c">‚ö†Ô∏è 33% cache unavailable if Redis M+R fails</text>
  <text x="1220" y="390" font-size="11" fill="#8e44ad">üåç Geographic routing reduces latency by 40%</text>
  
  <!-- ===== TECHNICAL CORRECTIONS ===== -->
  <rect x="1200" y="420" width="350" height="160" rx="8" fill="#f8c471" stroke="#f4d03f" stroke-width="2"/>
  <text x="1375" y="445" text-anchor="middle" font-size="14" fill="#2c3e50" font-weight="bold">Key Technical Corrections</text>
  <text x="1220" y="470" font-size="11" fill="#2c3e50">‚úÖ Database per service (no cross-service joins)</text>
  <text x="1220" y="485" font-size="11" fill="#2c3e50">‚úÖ MongoDB for flexible user preference schemas</text>
  <text x="1220" y="500" font-size="11" fill="#2c3e50">‚úÖ Redis 3M+3R cluster with realistic failure modes</text>
  <text x="1220" y="515" font-size="11" fill="#2c3e50">‚úÖ CDN only for static assets, not dynamic APIs</text>
  <text x="1220" y="530" font-size="11" fill="#2c3e50">‚úÖ Order‚ÜíPayment synchronous business flow</text>
  <text x="1220" y="545" font-size="11" fill="#2c3e50">‚úÖ Geographic DNS routing to regional LBs</text>
  <text x="1220" y="560" font-size="11" fill="#2c3e50">‚úÖ External APIs properly separated</text>
  <text x="1220" y="575" font-size="11" fill="#2c3e50">üéØ Interview-ready technical accuracy</text>
  
  <!-- Arrow Markers -->
  <defs>
    <marker id="arrowhead-red" markerWidth="6" markerHeight="4" refX="6" refY="2" orient="auto">
      <polygon points="0 0, 6 2, 0 4" fill="#e74c3c"/>
    </marker>
    <marker id="arrowhead-orange" markerWidth="6" markerHeight="4" refX="6" refY="2" orient="auto">
      <polygon points="0 0, 6 2, 0 4" fill="#f39c12"/>
    </marker>
    <marker id="arrowhead-purple" markerWidth="6" markerHeight="4" refX="6" refY="2" orient="auto">
      <polygon points="0 0, 6 2, 0 4" fill="#8e44ad"/>
    </marker>
  </defs>
</svg>